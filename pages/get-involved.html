<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Get Involved | Nasharie Writes</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="../images/favicon.png" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Poppins&display=swap" rel="stylesheet">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="../css/get-involved.css" />
  <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
  <style>
    #map {
      width: 100%;
      height: 500px;
      margin-top: 40px;
      border-radius: 10px;
    }
  </style>
</head>
<body>

<header class="header">
  <a href="../index.html">
    <img src="../images/blanklogo.png" alt="Nasharie Writes Logo" class="header-logo">
  </a>

  <nav class="nav-container">
    <ul>
      <li><a href="../index.html">Home</a></li>
      <li class="dropdown">
        <a href="#" onclick="return false;">Works <span class="arrow">▼</span></a>
        <ul class="dropdown-menu">
          <li><a href="../pages/transfer-student.html">The Transfer Student</a></li>
          <li><a href="../pages/works.html#short-stories">Short Stories</a></li>
          <li><a href="works.html#paper-trails">Paper Trails</a></li>
        </ul>
      </li>
      <li><a href="../pages/get-involved.html">Get Involved</a></li>
      <li><a href="../pages/contact.html">Contact</a></li>
    </ul>
  </nav>
</header>

<!-- Blurb Section (White) -->
<section class="blurb-section">
  <div class="intro-container">
    <h1 class="intro-title">Get Involved</h1>
    <p class="intro-text">
      In <em>The Transfer Student</em>, teachers are powerful forces for change — shaping not just classrooms, but futures.
      Whether you graduated years ago or are just starting your educational journey, if a teacher made an impact on your life, we invite you to honor them here.
      Share a thank you message and where you went to school. Your story will appear on our live gratitude map, inspiring others to celebrate the power of community and education.
    </p>
  </div>
</section>

<!-- Form + Map Section (Yellow) -->
<section class="submission-section">
  <div class="form-container">
    <form id="thank-form">
      <label for="location">Where did you attend school? (City, State/Country)</label>
      <input type="text" id="location" name="location" required maxlength="100" placeholder="Example: Philadelphia, PA">

      <label for="message">Thank a Teacher (Max 250 words)</label>
      <textarea id="message" name="message" required maxlength="1500" placeholder="Write your thank you here..."></textarea>

      <button type="submit">Submit</button>
    </form>
  </div>

  <div id="map"></div>
</section>

<footer>
  <p>&copy; 2025 Nasharie Stewart | All Rights Reserved</p>
</footer>

<script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
<script>
  mapboxgl.accessToken = 'pk.eyJ1IjoibnN0ZXdhcnQxMjgiLCJhIjoiY21hazV6OGd5MTUyazJrb3AyZzI1cTk4NiJ9.IbrFh9nn3zJzCIqC7O8KPQ';
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v11',
    center: [0, 20],
    zoom: 1.5
  });

  async function loadMarkers() {
    const res = await fetch('https://script.google.com/macros/s/AKfycbx0Wf4PbcpuzK6sBemEUVqX3ARGFYZ_qFrLH8psgEacarGIh4z11BK5RdtIQJPuapI/exec');
    const data = await res.json();
    data.forEach(entry => {
      if (entry.lat && entry.lng) {
        new mapboxgl.Marker()
          .setLngLat([entry.lng, entry.lat])
          .setPopup(new mapboxgl.Popup().setHTML(`<strong>${entry.location}</strong><br>${entry.message}`))
          .addTo(map);
      }
    });
  }

  loadMarkers();

  document.getElementById("thank-form").addEventListener("submit", async function (e) {
    e.preventDefault();

    const location = document.getElementById("location").value;
    const message = document.getElementById("message").value;

    const geoRes = await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(location)}.json?access_token=${mapboxgl.accessToken}`);
    const geoData = await geoRes.json();
    const coords = geoData.features[0]?.geometry?.coordinates;

    if (!coords) return alert("Location not found. Try again.");

    // Add marker immediately
    new mapboxgl.Marker()
      .setLngLat(coords)
      .setPopup(new mapboxgl.Popup().setHTML(`<strong>${location}</strong><br>${message}`))
      .addTo(map);

    // Save to Google Sheets
    await fetch('https://script.google.com/macros/s/AKfycbx0Wf4PbcpuzK6sBemEUVqX3ARGFYZ_qFrLH8psgEacarGIh4z11BK5RdtIQJPuapI/exec', {
      method: 'POST',
      body: new URLSearchParams({
        location: location,
        message: message,
        lat: coords[1],
        lng: coords[0]
      })
    });

    document.getElementById("thank-form").reset();
  });
</script>

</body>
</html>
